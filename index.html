<!DOCTYPE html>
<html>
<head>
  <title>AR.js - Menu interattivo scrollabile</title>
  <!-- Libreria A-Frame -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <!-- Libreria AR.js -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js"></script>

  <style>
    .message {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 18px;
      background-color: rgba(0,0,0,0.5);
      color: white;
      font-family: Arial, sans-serif;
      border-radius: 10px;
      z-index: 9999;
      user-select: none;
    }
  </style>
</head>

<body style="margin: 0; overflow: hidden;">
  <div id="info" class="message">Inquadra il marker...</div>

  <a-scene embedded arjs>
    <!-- Marker Hiro -->
    <a-marker preset="hiro" id="hiroMarker"></a-marker>

    <!-- Rettangolo (pannello menu) -->
    <a-plane id="menuPanel"
      position="0 0 -2"
      rotation="-45 0 0"
      width="1.2" height="1.8"
      color="#000000"
      opacity="0.7"
      visible="false">
      
      <!-- Titolo del menu -->
      <a-text value="Menu"
              color="#FFFFFF"
              position="0 0.75 0.01"
              align="center"
              width="1.2"></a-text>
      
      <!-- Container scrollabile con pulsanti -->
      <a-entity id="buttonContainer" position="0 0.2 0.01">
        <!-- Pulsante 1 -->
        <a-plane class="menu-button" color="#FF4444" width="1" height="0.3" position="0 0.4 0.01">
          <a-text value="Piatto 1" align="center" width="1" color="#FFF" position="0 0 0.02"></a-text>
        </a-plane>
        
        <!-- Pulsante 2 -->
        <a-plane class="menu-button" color="#44AAFF" width="1" height="0.3" position="0 0 0.01">
          <a-text value="Piatto 2" align="center" width="1" color="#FFF" position="0 0 0.02"></a-text>
        </a-plane>

        <!-- Pulsante 3 -->
        <a-plane class="menu-button" color="#44FF88" width="1" height="0.3" position="0 -0.4 0.01">
          <a-text value="Piatto 3" align="center" width="1" color="#FFF" position="0 0 0.02"></a-text>
        </a-plane>
      </a-entity>
      
    </a-plane>

    <!-- Camera con cursore -->
    <a-entity camera look-controls>
      <a-cursor rayOrigin="mouse"></a-cursor>
    </a-entity>
  </a-scene>

  <script>
    const marker = document.querySelector("#hiroMarker");
    const info = document.getElementById("info");
    const menuPanel = document.querySelector("#menuPanel");
    let isDragging = false, previousMousePosition;

    marker.addEventListener("markerFound", () => {
      info.innerText = "Marker rilevato!";
      menuPanel.setAttribute("visible", "true");
    });

    marker.addEventListener("markerLost", () => {
      info.innerText = "Marker perso, puoi spostare il menu.";
    });

    // Dragging migliorato
    menuPanel.addEventListener('mousedown', (e) => {
      isDragging = true;
      previousMousePosition = { x: e.clientX, y: e.clientY };
    });

    window.addEventListener('mouseup', () => { isDragging = false; });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      let deltaX = (e.clientX - previousMousePosition.x) / 250;
      let deltaY = (e.clientY - previousMousePosition.y) / 250;
      let position = menuPanel.getAttribute('position');
      menuPanel.setAttribute('position', {
        x: position.x + deltaX,
        y: position.y - deltaY,
        z: position.z
      });
      previousMousePosition = { x: e.clientX, y: e.clientY };
    });

    // Scroll verticale dei pulsanti (mobile + desktop)
    let buttonContainer = document.querySelector("#buttonContainer");
    let initialTouchY, initialContainerY = 0;

    buttonContainer.addEventListener('wheel', (e) => {
      let deltaY = e.deltaY * -0.001;
      let currentY = buttonContainer.object3D.position.y + deltaY;
      currentY = Math.min(Math.max(currentY, -0.5), 0.5);
      buttonContainer.object3D.position.y = currentY;
    });

    buttonContainer.addEventListener('touchstart', (e) => {
      initialTouchY = e.touches[0].clientY;
      initialContainerY = buttonContainer.object3D.position.y;
    });

    buttonContainer.addEventListener('touchmove', (e) => {
      let deltaY = (e.touches[0].clientY - initialTouchY) * 0.002;
      let currentY = initialContainerY + deltaY;
      currentY = Math.min(Math.max(currentY, -0.5), 0.5);
      buttonContainer.object3D.position.y = currentY;
    });

    // Interazione con i pulsanti
    document.querySelectorAll('.menu-button').forEach(btn => {
      btn.addEventListener('click', (evt) => {
        info.innerText = "Hai cliccato: " + evt.target.querySelector('a-text').getAttribute('value');
      });
    });
  </script>
</body>
</html>
