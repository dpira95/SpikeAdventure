<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Componente Pulsante AR</title>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            touch-action: none;
        }
        #status {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            font-family: Arial;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="status">Inquadra il marker Hiro</div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;"
        renderer="logarithmicDepthBuffer: true;"
    >
        <!-- Marker Hiro -->
        <a-marker preset="hiro" id="marker" emitevents="true"></a-marker>
        
        <!-- Contenitore principale -->
        <a-entity id="menu-container" position="0 1.5 0">
            <!-- ESEMPIO DI PULSANTE -->
            <a-entity class="menu-item" position="0 0 0">
                <!-- Hitbox (invisibile +20% del pulsante) -->
                <a-entity class="clickable hitbox"
                    geometry="primitive: box; width: 1.8; height: 0.6; depth: 0.2"
                    material="visible: false"
                    position="0 0 0"
                    event-set__mouseenter="scale: 1.05 1.05 1.05"
                    event-set__mouseleave="scale: 1 1 1">
                </a-entity>
                
                <!-- Pulsante visivo -->
                <a-box class="button-visual"
                    width="1.5"
                    height="0.5"
                    depth="0.1"
                    color="#4CC3D9"
                    position="0 0 0.01">
                    
                    <!-- Testo sinistro -->
                    <a-text class="item-name"
                        value="Pizza Margherita"
                        align="left"
                        position="-0.65 0 0.1"
                        width="1.2"
                        color="white">
                    </a-text>
                    
                    <!-- Testo destro -->
                    <a-text class="item-price"
                        value="3€"
                        align="right"
                        position="0.65 0 0.1"
                        width="0.5"
                        color="white">
                    </a-text>
                </a-box>
            </a-entity>
        </a-entity>

        <!-- Camera con raycaster ottimizzato -->
        <a-entity camera>
            <a-entity cursor="rayOrigin: mouse"
                     raycaster="far: 1000; interval: 1; objects: .hitbox"></a-entity>
        </a-entity>
    </a-scene>

    <script>
        // 1. INIZIALIZZAZIONE
        const statusDiv = document.getElementById('status');
        const container = document.getElementById('menu-container');
        let markerVisible = false;

        // 2. CREAZIONE COMPONENTE PULSANTE
        function createButton(itemName, price, yPosition) {
            return `
                <a-entity class="menu-item" position="0 ${yPosition} 0">
                    <a-entity class="clickable hitbox"
                        geometry="primitive: box; width: 1.8; height: 0.6; depth: 0.2"
                        material="visible: false"
                        position="0 0 0"
                        event-set__mouseenter="scale: 1.05 1.05 1.05"
                        event-set__mouseleave="scale: 1 1 1"
                        onclick="itemSelected('${itemName}')">
                    </a-entity>
                    
                    <a-box class="button-visual"
                        width="1.5"
                        height="0.5"
                        depth="0.1"
                        color="#4CC3D9"
                        position="0 0 0.01">
                        
                        <a-text class="item-name"
                            value="${itemName}"
                            align="left"
                            position="-0.65 0 0.1"
                            width="1.2"
                            color="white">
                        </a-text>
                        
                        <a-text class="item-price"
                            value="${price}€"
                            align="right"
                            position="0.65 0 0.1"
                            width="0.5"
                            color="white">
                        </a-text>
                    </a-box>
                </a-entity>
            `;
        }

        // 3. GESTIONE INTERAZIONI
        function itemSelected(name) {
            statusDiv.textContent = `Selezionato: ${name}`;
            // Aggiungi qui la logica di selezione
        }

        // 4. GESTIONE MARKER
        document.getElementById('marker').addEventListener('markerFound', (e) => {
            if(!markerVisible) {
                const markerPos = e.target.object3D.position;
                container.setAttribute('position', `${markerPos.x} ${markerPos.y + 1.5} ${markerPos.z}`);
                container.setAttribute('visible', 'true');
                markerVisible = true;
                statusDiv.textContent = "Menu pronto - Seleziona un'opzione";
                
                // Esempio: Aggiungi 3 pulsanti dinamicamente
                container.innerHTML += createButton("Pasta Carbonara", "8", -0.6);
                container.innerHTML += createButton("Insalata Cesare", "6", -1.2);
                container.innerHTML += createButton("Tiramisù", "4", -1.8);
                
                refreshRaycaster();
            }
        });

        // 5. UTILITY
        function refreshRaycaster() {
            const scene = document.querySelector('a-scene');
            if(scene && scene.components.raycaster) {
                scene.components.raycaster.refreshObjects();
            }
        }

        // 6. CONFIGURAZIONE TOUCH
        document.querySelectorAll('.hitbox').forEach(hitbox => {
            hitbox.addEventListener('touchstart', (e) => {
                e.preventDefault();
                hitbox.setAttribute('scale', '0.95 0.95 0.95');
            });
            
            hitbox.addEventListener('touchend', (e) => {
                e.preventDefault();
                hitbox.setAttribute('scale', '1 1 1');
                const itemName = hitbox.getAttribute('onclick').match(/'([^']+)'/)[1];
                itemSelected(itemName);
            });
        });

        // 7. AVVIO
        window.addEventListener('load', () => {
            setTimeout(refreshRaycaster, 1000);
        });
    </script>
</body>
</html>
