<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Menu AR Completo</title>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        .menu-panel {
            background: rgba(51, 51, 51, 0.95);
            border-radius: 0.25em;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        .menu-btn {
            cursor: pointer;
            transition: all 0.2s;
        }
        .menu-btn:hover, .menu-btn:active {
            opacity: 0.9;
            transform: scale(1.05);
        }
        .btn-text {
            font-family: 'Arial', sans-serif;
            text-align: center;
            font-weight: bold;
        }
        #loading-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            font-family: Arial;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="loading-message">Caricamento AR...</div>
    
    <a-scene embedded arjs="trackingMethod: best;" renderer="logarithmicDepthBuffer: true;" vr-mode-ui="enabled: false">
        
        <!-- Marker Hiro -->
        <a-marker preset="hiro" id="ar-marker">
            
            <!-- Contenitore principale con variabili globali -->
            <a-entity id="global-container">
                
                <!-- Menu Principale -->
                <a-entity id="main-menu" class="menu-panel">
                    <a-plane class="panel-bg" width="2.8" height="2.0" position="0 0 0.1"></a-plane>
                    
                    <a-text class="panel-title" value="MENU PRINCIPALE" position="0 0.8 0.15" width="3.5"></a-text>
                    
                    <!-- Pulsante 1 -->
                    <a-entity class="menu-btn btn-1" position="-0.7 0.2 0.15" data-panel="info">
                        <a-box width="1.0" height="0.45" depth="0.05" color="#4CC3D9"></a-box>
                        <a-text class="btn-text" value="INFO" position="0 0 0.06" width="3"></a-text>
                    </a-entity>
                    
                    <!-- Pulsante 2 -->
                    <a-entity class="menu-btn btn-2" position="0.7 0.2 0.15" data-panel="settings">
                        <a-box width="1.0" height="0.45" depth="0.05" color="#EF2D5E"></a-box>
                        <a-text class="btn-text" value="IMPOSTAZIONI" position="0 0 0.06" width="3"></a-text>
                    </a-entity>
                    
                    <!-- Pulsante 3 -->
                    <a-entity class="menu-btn btn-3" position="0 -0.4 0.15" data-panel="gallery">
                        <a-box width="2.0" height="0.45" depth="0.05" color="#7BC8A4"></a-box>
                        <a-text class="btn-text" value="GALLERIA" position="0 0 0.06" width="3"></a-text>
                    </a-entity>
                </a-entity>
                
                <!-- Pannello Info -->
                <a-entity id="info-panel" class="menu-panel" visible="false">
                    <a-plane class="panel-bg" width="2.8" height="2.0" position="0 0 0.1"></a-plane>
                    <a-text class="panel-title" value="INFORMAZIONI" color="#4CC3D9" position="0 0.8 0.15" width="3.5"></a-text>
                    <a-text value="Benvenuto nel menu AR\n\nSeleziona le opzioni\ndai pulsanti principali" 
                           align="center" position="0 0.1 0.15" width="2.5" color="#FFF"></a-text>
                    <a-entity class="menu-btn back-btn" position="0 -0.7 0.15" data-panel="main">
                        <a-box width="1.0" height="0.4" depth="0.05" color="#EF2D5E"></a-box>
                        <a-text class="btn-text" value="INDIETRO" position="0 0 0.06" width="3"></a-text>
                    </a-entity>
                </a-entity>
                
                <!-- Altri pannelli (simili) -->
                <a-entity id="settings-panel" class="menu-panel" visible="false">
                    <!-- ... struttura simile ... -->
                </a-entity>
                
                <a-entity id="gallery-panel" class="menu-panel" visible="false">
                    <!-- ... struttura simile ... -->
                </a-entity>
                
                <!-- Oggetto 3D dimostrativo -->
                <a-entity id="3d-model" position="0 0.5 0.5">
                    <a-box color="yellow" width="0.5" height="0.5" depth="0.5"></a-box>
                </a-entity>
            </a-entity>
        </a-marker>
        
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // =============================================
        // CONFIGURAZIONE GLOBALE (MODIFICA QUI)
        // =============================================
        const CONFIG = {
            // Trasformazioni principali
            rotation: { x: -4, y: 0, z: 0 },  // Rotazione base (gradi)
            position: { x: 0, y: 1.4, z: 0.2 }, // Posizione base (metri)
            scale: 0.75,                       // Scala uniforme
            
            // Spaziature
            panelSpacing: 0.15,                // Distanza tra pannelli sull'asse Z
            elementOffset: 0.05,               // Offset elementi interni
            
            // Stili
            colors: {
                primary: "#4CC3D9",
                secondary: "#EF2D5E",
                accent: "#7BC8A4",
                background: "#333333",
                text: "#FFFFFF"
            },
            
            // Dimensioni
            panelWidth: 2.8,
            panelHeight: 2.0,
            buttonWidth: 1.0,
            buttonHeight: 0.45
        };

        // =============================================
        // INIZIALIZZAZIONE
        // =============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Nascondi messaggio caricamento
            document.getElementById('loading-message').style.display = 'none';
            
            // Ottieni riferimenti agli elementi
            const container = document.getElementById('global-container');
            const marker = document.getElementById('ar-marker');
            
            // Applica configurazione globale
            applyGlobalConfig();
            
            // Gestione eventi marker
            marker.addEventListener('markerFound', () => onMarkerFound());
            marker.addEventListener('markerLost', () => onMarkerLost());
            
            // Inizializza interazioni
            initInteractions();
        });

        // =============================================
        // FUNZIONI PRINCIPALI
        // =============================================
        function applyGlobalConfig() {
            const container = document.getElementById('global-container');
            
            // Applica trasformazioni principali
            container.setAttribute('rotation', `${CONFIG.rotation.x} ${CONFIG.rotation.y} ${CONFIG.rotation.z}`);
            container.setAttribute('position', `${CONFIG.position.x} ${CONFIG.position.y} ${CONFIG.position.z}`);
            container.setAttribute('scale', `${CONFIG.scale} ${CONFIG.scale} ${CONFIG.scale}`);
            
            // Applica a tutti i pannelli
            document.querySelectorAll('.menu-panel').forEach((panel, index) => {
                // Posizione Z progressiva
                const zPos = CONFIG.position.z + (index * CONFIG.panelSpacing);
                panel.setAttribute('position', `0 0 ${zPos}`);
                
                // Sfondo
                const bg = panel.querySelector('.panel-bg');
                if(bg) {
                    bg.setAttribute('width', CONFIG.panelWidth);
                    bg.setAttribute('height', CONFIG.panelHeight);
                    bg.setAttribute('color', CONFIG.colors.background);
                    bg.setAttribute('position', `0 0 ${CONFIG.elementOffset}`);
                }
                
                // Titoli
                const title = panel.querySelector('.panel-title');
                if(title) {
                    title.setAttribute('color', CONFIG.colors.primary);
                    title.setAttribute('position', `0 0.8 ${CONFIG.elementOffset + 0.05}`);
                }
            });
            
            // Applica a tutti i pulsanti
            document.querySelectorAll('.menu-btn').forEach(btn => {
                // Compensazione rotazione
                btn.setAttribute('rotation', `${-CONFIG.rotation.x} 0 0`);
                
                // Posizione Z
                const pos = btn.getAttribute('position');
                if(pos) {
                    const newZ = parseFloat(pos.z) + CONFIG.elementOffset;
                    btn.setAttribute('position', `${pos.x} ${pos.y} ${newZ}`);
                }
                
                // Stili
                const box = btn.querySelector('a-box');
                if(box) {
                    box.setAttribute('width', CONFIG.buttonWidth);
                    box.setAttribute('height', CONFIG.buttonHeight);
                }
            });
        }

        function initInteractions() {
            // Gestione click/touch
            document.querySelectorAll('.menu-btn').forEach(btn => {
                // Click mouse
                btn.addEventListener('click', function() {
                    handleButtonClick(this);
                });
                
                // Touch mobile
                btn.addEventListener('touchstart', function() {
                    this.setAttribute('scale', '0.95 0.95 0.95');
                });
                
                btn.addEventListener('touchend', function() {
                    this.setAttribute('scale', '1 1 1');
                    handleButtonClick(this);
                });
            });
        }

        function handleButtonClick(btn) {
            if(!btn.dataset.panel) return;
            
            // Animazione click
            btn.setAttribute('scale', '0.9 0.9 0.9');
            setTimeout(() => {
                btn.setAttribute('scale', '1 1 1');
            }, 150);
            
            // Cambio pannello
            showPanel(btn.dataset.panel);
        }

        function showPanel(panelName) {
            // Nascondi tutti i pannelli
            document.querySelectorAll('.menu-panel').forEach(panel => {
                panel.setAttribute('visible', 'false');
            });
            
            // Mostra il pannello richiesto
            const panel = document.getElementById(`${panelName}-panel`);
            if(panel) {
                panel.setAttribute('visible', 'true');
            }
        }

        function onMarkerFound() {
            // Ripristina l'ultimo pannello visibile
            showPanel('main');
        }

        function onMarkerLost() {
            // Nascondi tutto quando il marker non è visibile
            document.querySelectorAll('.menu-panel').forEach(panel => {
                panel.setAttribute('visible', 'false');
            });
        }

        // Animazione continua dell'oggetto 3D
        setInterval(() => {
            const model = document.getElementById('3d-model');
            if(model) {
                const rotation = model.getAttribute('rotation') || { x: 0, y: 45, z: 45 };
                model.setAttribute('rotation', {
                    x: rotation.x,
                    y: rotation.y + 0.7,
                    z: rotation.z
                });
            }
        }, 50);
    </script>
</body>
</html>
