<!DOCTYPE html>
<html>
<head>
  <title>AR.js - Menu interattivo scroll e trascinabile</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js"></script>

  <style>
    .message {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 18px;
      background-color: rgba(0,0,0,0.5);
      color: white;
      font-family: Arial, sans-serif;
      border-radius: 10px;
      z-index: 9999;
      user-select: none;
    }
  </style>
</head>

<body style="margin: 0; overflow: hidden;">
  <div id="info" class="message">Inquadra il marker...</div>

  <a-scene embedded arjs>
    <a-marker preset="hiro" id="hiroMarker"></a-marker>

    <a-plane id="menuPanel"
      position="0 0 -2"
      rotation="-45 0 0"
      width="1.2" height="1.8"
      color="#000000"
      opacity="0.7"
      visible="false">

      <a-text value="Menu" color="#FFFFFF"
              position="0 0.75 0.02" align="center" width="1.2"></a-text>

      <!-- Container scrollabile con 6 pulsanti -->
      <a-entity id="buttonContainer" position="0 0 0.01">
        <a-plane class="menu-button" color="#FF4444" width="1" height="0.25" position="0 0.7 0.01">
          <a-text value="Piatto 1" align="center" width="1" color="#FFF"></a-text>
        </a-plane>
        <a-plane class="menu-button" color="#44AAFF" width="1" height="0.25" position="0 0.4 0.01">
          <a-text value="Piatto 2" align="center" width="1" color="#FFF"></a-text>
        </a-plane>
        <a-plane class="menu-button" color="#44FF88" width="1" height="0.25" position="0 0.1 0.01">
          <a-text value="Piatto 3" align="center" width="1" color="#FFF"></a-text>
        </a-plane>
        <a-plane class="menu-button" color="#FFAA44" width="1" height="0.25" position="0 -0.2 0.01">
          <a-text value="Piatto 4" align="center" width="1" color="#FFF"></a-text>
        </a-plane>
        <a-plane class="menu-button" color="#AA44FF" width="1" height="0.25" position="0 -0.5 0.01">
          <a-text value="Piatto 5" align="center" width="1" color="#FFF"></a-text>
        </a-plane>
        <a-plane class="menu-button" color="#FF4488" width="1" height="0.25" position="0 -0.8 0.01">
          <a-text value="Piatto 6" align="center" width="1" color="#FFF"></a-text>
        </a-plane>
      </a-entity>

    </a-plane>

    <a-entity camera look-controls>
      <a-cursor rayOrigin="mouse"></a-cursor>
    </a-entity>
  </a-scene>

<script>
const marker = document.querySelector("#hiroMarker");
const info = document.getElementById("info");
const menuPanel = document.querySelector("#menuPanel");
const buttonContainer = document.querySelector("#buttonContainer");

let isMarkerFound = false, isDraggingPanel = false;
let startPressTimer, longPressActive = false;
let prevPosition = { x: 0, y: 0 };

// Rilevamento marker
marker.addEventListener("markerFound", () => {
  isMarkerFound = true;
  info.innerText = "Marker rilevato!";
  menuPanel.setAttribute("visible", "true");
});

marker.addEventListener("markerLost", () => {
  info.innerText = "Marker perso, puoi interagire col menu.";
});

// Gestione long-press per spostamento del pannello
menuPanel.addEventListener('touchstart', (e) => {
  startPressTimer = setTimeout(() => {
    longPressActive = true;
  }, 500);
  prevPosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
});

menuPanel.addEventListener('touchend', () => {
  clearTimeout(startPressTimer);
  longPressActive = false;
});

// Movimento pannello o scroll
window.addEventListener('touchmove', (e) => {
  if (!isMarkerFound) return;

  let deltaX = (e.touches[0].clientX - prevPosition.x) / 200;
  let deltaY = (e.touches[0].clientY - prevPosition.y) / 200;

  if (longPressActive) { 
    // Sposta pannello se premuto a lungo
    let pos = menuPanel.object3D.position;
    menuPanel.object3D.position.set(pos.x + deltaX, pos.y - deltaY, pos.z);
  } else {
    // Scroll verticale se non premuto a lungo
    let pos = buttonContainer.object3D.position;
    let newY = pos.y - deltaY;
    newY = Math.min(Math.max(newY, -0.5), 0.5);
    buttonContainer.object3D.position.set(pos.x, newY, pos.z);
  }

  prevPosition = { x: e.touches[0].clientX, y: e.touches[0].clientY };
}, { passive: false });

// Interazione pulsanti
document.querySelectorAll('.menu-button').forEach(btn => {
  btn.addEventListener('click', evt => {
    info.innerText = "Hai scelto: " + evt.target.querySelector('a-text').getAttribute('value');
  });
});
</script>
</body>
</html>
